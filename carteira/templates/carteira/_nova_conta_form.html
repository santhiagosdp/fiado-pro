{# carteira/_nova_conta_form.html #}

{# Exibe erros gerais, se houver #}
{% if cliente_form.errors or conta_form.errors or item_formset.non_form_errors %}
  <div class="alert alert-danger">
    <strong>Verifique os campos destacados.</strong>
    {{ cliente_form.non_field_errors }}
    {{ conta_form.non_field_errors }}
    {{ item_formset.non_form_errors }}
  </div>
{% endif %}

{# Campos ocultos dos formulários (se houver) #}
{% for hidden in cliente_form.hidden_fields %}
  {{ hidden }}
{% endfor %}
{% for hidden in conta_form.hidden_fields %}
  {{ hidden }}
{% endfor %}

{# ===================== CLIENTE (busca + dados) ===================== #}
<div class="mb-2">
  <label class="form-label fw-semibold">Cliente</label>
  <div class="position-relative">
    <input type="text"
           id="cliente_search"
           class="form-control"
           placeholder="Digite o nome do cliente…"
           autocomplete="off">

    <input type="hidden" id="id_cliente_id" name="cliente_id">

    <div id="cliente_suggestions"
         class="list-group position-absolute w-100 shadow-sm"
         style="z-index: 1056; max-height: 220px; overflow-y: auto; display: none;">
    </div>
  </div>
  <div class="form-text">
    Comece a digitar o nome para buscar.
    Se não encontrar, clique em
    <button type="button"
            class="btn btn-link btn-sm p-0 align-baseline"
            id="btn-novo-cliente-inline">
      Cadastrar novo cliente
    </button>.
  </div>
</div>

<div id="cliente-dados" class="modal-form-grid two-cols mt-2">
  <div class="col-12">
    <label class="form-label fw-semibold">Nome</label>
    {{ cliente_form.nome }}
  </div>
  <div>
    <label class="form-label fw-semibold">CPF</label>
    {{ cliente_form.cpf }}
  </div>
  <div>
    <label class="form-label fw-semibold">Telefone</label>
    {{ cliente_form.telefone }}
  </div>
  <div class="col-12">
    <label class="form-label fw-semibold">E-mail</label>
    {{ cliente_form.email }}
  </div>
  <div class="col-12">
    <label class="form-label fw-semibold">Endereço</label>
    {{ cliente_form.endereco }}
  </div>
</div>

<hr class="my-3">

{# ===================== DADOS DA CONTA ===================== #}
<div class="modal-form-grid two-cols">
  <div>
    <label class="form-label fw-semibold">Vencimento</label>
    {{ conta_form.vencimento }}
  </div>
</div>

<hr class="my-3">

{# ===================== ITENS DA VENDA (FORMSET DINÂMICO) ===================== #}
<div>
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h6 class="fw-semibold mb-0">Itens da venda</h6>
    <button type="button"
            class="btn btn-outline-secondary btn-sm"
            id="btn-add-item">
      + Adicionar item
    </button>
  </div>

  {{ item_formset.management_form }}

  <div id="itens-container">
    {% for form in item_formset %}
      <div class="row g-2 mb-2 item-row">
        <div class="col-6">
          {{ form.produto.label_tag }} {{ form.produto }}
        </div>
        <div class="col-3">
          {{ form.quantidade.label_tag }} {{ form.quantidade }}
        </div>
        <div class="col-3">
          {{ form.valor_unit.label_tag }} {{ form.valor_unit }}
        </div>
        {# Se quiser habilitar remoção depois, dá pra usar form.DELETE aqui #}
      </div>
    {% endfor %}
  </div>

  {# Template do formulário vazio para o JS clonar #}
  <script type="text/template" id="item-empty-form-template">
    <div class="row g-2 mb-2 item-row">
      <div class="col-6">
        {{ item_formset.empty_form.produto.label_tag }} {{ item_formset.empty_form.produto }}
      </div>
      <div class="col-3">
        {{ item_formset.empty_form.quantidade.label_tag }} {{ item_formset.empty_form.quantidade }}
      </div>
      <div class="col-3">
        {{ item_formset.empty_form.valor_unit.label_tag }} {{ item_formset.empty_form.valor_unit }}
      </div>
    </div>
  </script>
</div>
